#!/bin/bash

## üìå Passo 1: Identificar o shell atual e arquivo de configura√ß√£o
current_shell=$(basename "$SHELL")
case $current_shell in
    "bash") config_file="$HOME/.bashrc" ;;
    "zsh") config_file="$HOME/.zshrc" ;;
    *)
        echo "‚ùå Shell n√£o suportado: $current_shell"
        exit 1
        ;;
esac

## üìå Passo 2: Verificar se o arquivo de configura√ß√£o existe
if [ ! -f "$config_file" ]; then
    echo "‚ö†Ô∏è Arquivo de configura√ß√£o n√£o encontrado: $config_file"
    echo "üëâ Criando novo arquivo..."
    touch "$config_file"
fi

## üìå Passo 3: Gerar caminho absoluto do diret√≥rio do script
script_dir="$(pwd)"

## üìå Passo 4: Configurar o PATH
# A vari√°vel script_dir √© adicionada ao PATH para que f2j e f2jt sejam execut√°veis.
path_line="export PATH=\"\$PATH:$script_dir\""

# Verifica se o diret√≥rio J√Å est√° no PATH para evitar duplica√ß√£o
if grep -q "$script_dir" "$config_file"; then
    echo "‚òëÔ∏è  O diret√≥rio $script_dir j√° est√° no PATH."
else
    echo "üîß Adicionando $script_dir ao PATH em $config_file"
    echo -e "\n# Configura√ß√£o de comandos f2j e f2jt (adicionado automaticamente)" >> "$config_file"
    echo "$path_line" >> "$config_file"
fi

## üìå Passo 5: Mensagem final e permiss√µes

# Garante que os scripts sejam execut√°veis
chmod +x f2j 2>/dev/null
chmod +x f2jt 2>/dev/null

echo "‚úÖ Instala√ß√£o conclu√≠da!"
echo "    Os comandos 'f2j', 'json' (alias) e 'f2jt' (atalho tree) est√£o prontos para uso."
echo "Para ativar imediatamente, execute:"
echo "    source $config_file"